<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Applications</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <link rel="stylesheet" href="https://cdn.datatables.net/2.3.5/css/dataTables.dataTables.css">
    <script src="https://cdn.datatables.net/2.3.5/js/dataTables.js"></script>
</head>

<body class="bg-neutral-900 text-white">

<div th:replace="~{fragments/navbar :: navbar}"></div>

<div class="max-w-7xl mx-auto py-16 px-4">

    <div class="text-sm text-neutral-400 mb-6">
        <a href="/dashboard" class="hover:text-[#aa955e]">Dashboard</a>
        <span class="mx-1">›</span>
        <a href="/students" class="hover:text-[#aa955e]">Students</a>
        <span class="mx-1">›</span>
        <span class="font-semibold text-white"
              th:text="${student.firstName + ' ' + student.lastName}"></span>
    </div>

    <h1 class="text-4xl font-bold mb-8"
        th:text="'Applications of ' + ${student.firstName + ' ' + student.lastName}"></h1>

    <div class="bg-neutral-800 rounded-xl p-6 shadow-lg border border-neutral-700 overflow-x-auto">

        <table id="appsTable" class="display w-full text-sm border border-neutral-700 rounded-md">

            <thead class="bg-neutral-700 border-b border-neutral-600">
            <tr>
                <th class="px-4 py-2 text-left no-sort">Logo</th>
                <th class="px-4 py-2 text-left">Placement</th>
                <th class="px-4 py-2 text-left">Status</th>
                <th class="px-4 py-2 text-left">Applied</th>
                <th class="px-4 py-2 text-left">Cover Letter</th>
                <th class="px-4 py-2 text-left no-sort">Actions</th>
            </tr>
            </thead>

            <tbody class="divide-y divide-neutral-700">

            <tr th:each="row : ${rows}">

                <td class="px-4 py-3">
                    <img th:src="${row.placement.companyLogo}"
                         class="w-10 h-10 rounded object-cover"/>
                </td>

                <td class="px-4 py-3" th:text="${row.placement.title}"></td>

                <td class="px-4 py-3" th:text="${#strings.capitalize(#strings.replace(row.application.status, '_', ' '))}"></td>

                <td class="px-4 py-3"
                    th:text="${#dates.format(row.application.appliedDate, 'yyyy-MM-dd')}"></td>

                <td class="px-4 py-3"
                    th:text="${row.application.coverLetter.length() > 40
                             ? row.application.coverLetter.substring(0,40) + '...'
                             : row.application.coverLetter}"></td>

                <td class="px-4 py-3">
                    <a th:href="${row.application.screenshotUrl}"
                       target="_blank"
                       class="text-blue-400 hover:text-blue-300 text-xl mr-4">
                        <i class="fa-solid fa-image"></i>
                    </a>

                    <a th:href="@{'/placements/edit/' + ${row.placement.id}}"
                       class="text-yellow-400 hover:text-yellow-300 text-xl mr-4">
                        <i class="fa-solid fa-briefcase"></i>
                    </a>
                </td>

            </tr>

            </tbody>
        </table>

    </div>

</div>

<div th:replace="~{fragments/snackbar :: snackbar}"></div>
<div th:replace="~{fragments/footer :: footer}"></div>

<script>
    new DataTable("#appsTable", {
        columnDefs: [
            { orderable: false, targets: "no-sort" }
        ],
        layout: {
            topStart: { search: { placeholder: "Search applications..." }},
            topEnd: { pageLength: { menu: [5, 10, 25, 50] }},
            bottomEnd: { paging: { buttons: 3 }}
        },
        language: {
            lengthMenu: "Show _MENU_ applications per page",
            info: "Showing _START_ to _END_ of _TOTAL_ applications",
            infoEmpty: "No applications found",
            infoFiltered: "(filtered from _MAX_ total)",
            emptyTable: "No applications found",
            zeroRecords: "No matching application",
            paginate: { previous: "Prev", next: "Next" }
        }
    });
</script>

</body>
</html>